<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>index</title>
	
		<script>
			function onExercise () {
				console.log ("starting exercise, blocks:", arguments);
			}
			
			function onKeyDown () {
				console.log ("key down:", arguments);
				
				var command = arguments[0].socketCommand;
				if (command) {
					document.getElementById("live").incomingData(command);
				}
			}
			
			function onNewBlock (parts, partsShort) {
				console.log (parts, partsShort)
				// join the characters
				var html = "";
				for (var i = 0; i < parts.length; i++) {
					var part = parts [i];
					
					if ((part.length == 7) && (part.indexOf("SHIFT") == 0)) {
						// SHIFT 1..0 special case
						part = partsShort [i];
					}
					
					var character = "";
					if (part.length == 1) {
						// lowercase text
						character = part.toLowerCase();
					} else if ((part.length == 7) && (part.indexOf("SHIFT") == 0)) {
						// uppercase text
						character = part.substr (-1);
					}
					
					if (character.length > 0) {
						html += "<span class='char'>" + character + "</span>"
					} else {
						// could be mapped to images here
						if (part == "TAB") {
							html += "<img src='http://4v4.com/images/keys/key_tab.gif' hspace='10' />";
						} else {
							// misc keys
							html += ", " + partsShort [i] + " ";
						}
					}
				}
				
				if (html.indexOf(", ") == 0) html = html.substr(2);
				
				document.getElementById("block").innerHTML = html;
			}
			
			function onExerciseComplete () {
				console.log("done:", arguments);
			}
			
			function keyDown(e) {
				var keycode = e.keyCode?e.keyCode:e.keyChar;
				
				var param = new Object(); 
				param['keyCode'] = e.keyCode; 
				param['shiftKey'] = e.shiftKey; 
				param['shiftLeft'] = e.shiftLeft; 
				param['ctrlKey'] = e.ctrlKey; 
				param['ctrlLeft'] = e.ctrlLeft; 
				param['altKey'] = e.altKey; 
				param['metaKey'] = e.metaKey;
				
				document.getElementById("SP1Player").keyHandlerForAS(JSON.stringify(param));
				document.body.focus();
				return false;
			}
			
			function focus_on(seconds) {
			  var seconds_waited
			  seconds_waited = seconds
			  document.getElementById('getkey').focus(); 
			  seconds_waited += 100;

			  if (document.getElementById('getkey') != document.activeElement && seconds_waited < 2000)
			  {
				  setTimeout("focus_on(" + seconds_waited + ");", 100);
			  }
			  
			  if (seconds_waited >= 2000)
			  {
			  	console.log("not found");
			  }
			}
			
			function activateFromAS() {
				focus_on(0);
			}
			
			document.onClick = function() {
				console.log("click");
				
				document.getElementById('getkey').focus();
				
				return false;
			}
			
		</script>
		
		<style type="text/css" media="screen">
			body { background-color:#222;margin:0;}
			#block { color:#FFFFFF;}
			.char { color:#007FFF;}
		</style>	
		
	</head>

	<body onload="document.getElementById('getkey').focus();">
		  <input type="button" id="getkey" onkeydown="return keyDown(event)"/>
		  <div id="block"></div>
	      <object id="SP1Player" type="application/x-shockwave-flash" data="SP1Player.swf" width="1000" height="800">
                    <param name="quality" value="high" />
                    <param name="bgcolor" value="#222222" />
                    <param name="allowScriptAccess" value="sameDomain" />
                    <param name="allowFullScreenInteractive" value="true" />
					<param name="FlashVars" value="config=config.xml" />
          </object>  
		
	      <object type="application/x-shockwave-flash" data="CitrusPlatformer.swf" width="1024" height="768" id="live">
                    <param name="quality" value="high" />
                    <param name="bgcolor" value="#59b3ff" />
                    <param name="allowScriptAccess" value="sameDomain" />
                    <param name="allowFullScreenInteractive" value="true" />
					<param name="wmode" value="direct" />
          </object>  
	</body>
	
</html>